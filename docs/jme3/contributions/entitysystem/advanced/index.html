<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">
<script src="/js/dark_default.js"></script>

<title data-react-helmet="true">advanced | jMonkeyEngine Documentation</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="advanced | jMonkeyEngine Documentation"><meta data-react-helmet="true" name="description" content="In this article we explain how the JMonkey Entity System looks like and"><meta data-react-helmet="true" property="og:description" content="In this article we explain how the JMonkey Entity System looks like and"><meta data-react-helmet="true" property="og:url" content="https://8keep.github.io/wikidemo/docs/jme3/contributions/entitysystem/advanced">

<link data-react-helmet="true" rel="shortcut icon" href="/wikidemo/img/favicon.ico">


<link rel="stylesheet" href="/wikidemo/styles.7d008dc0.css">


<link rel="preload" href="/wikidemo/styles.08ff7081.js" as="script">

<link rel="preload" href="/wikidemo/runtime~main.0f38d2b7.js" as="script">

<link rel="preload" href="/wikidemo/main.1b6aa70f.js" as="script">

<link rel="preload" href="/wikidemo/1.e501629b.js" as="script">

<link rel="preload" href="/wikidemo/2.c824d386.js" as="script">

<link rel="preload" href="/wikidemo/302.1d1a2997.js" as="script">

<link rel="preload" href="/wikidemo/394d525a.30c299b8.js" as="script">

<link rel="preload" href="/wikidemo/17896441.d065d5f5.js" as="script">

<link rel="preload" href="/wikidemo/ee7e965f.ea7050a8.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/wikidemo/"><img class="navbar__logo" src="/wikidemo/img/iconx128.png" alt="JmonkeyEngine"><strong class="navbar__title"></strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/wikidemo/docs/documentation">Docs</a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="https://github.com/8keep/wikidemo" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/wikidemo/"><img class="navbar__logo" src="/wikidemo/img/iconx128.png" alt="JmonkeyEngine"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/wikidemo/docs/documentation">Docs</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/8keep/wikidemo" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">advanced</h1></header><div class="markdown"><p>In this article we explain how the JMonkey Entity System looks like and
why.</p><p>If you are new to this subject please read the <a href="/wikidemo/docs/jme3/contributions/entitysystem/introduction">Entity System
Introduction</a>
first.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="multithreading"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#multithreading" title="Direct link to heading">#</a>Multithreading</h1><p>One difference between the JMonkey Entity System and other Entity
Systems is that you are allowed to access the system from various
threads. This can give your game a huge performance boost because costly
task can easily separated in an own thread. This leads to an unique
design of the components and the introduction to Entity Sets.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="entity-sets"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#entity-sets" title="Direct link to heading">#</a>Entity Sets</h2><p>One part of this special approach are the Entity Sets. Most of the time
you want to work with Entities you create an Entity Set and add the
class names of the components you are interested in to the constructor.
In the background the Entity Set now creates Entity objects for all
entities that contain the passed component classes. This Entities
<strong>only</strong> hold the the components the Set is interested in. This means
different Entity Sets have two different Entity objects for the same
entity. Therefore changes of one entity must be synchronized with the
other entity sets. This works with events created for every change and
passed to the other entity sets. With the method applyChanges() this
entity Set will update all of their entities or remove/add new ones.
Besides after this method call you have a direct access to all
added,changed and removed entities separately and there is no need to
loop through all entities.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="components"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#components" title="Direct link to heading">#</a>Components</h2><p>Because components have no other methods except the getter, changes are
made by replacing the component of an entity with a new one. Therefore
an entity can only have one component of the same class. If a component
would have a setter no event would fired and parallel processing would
not be possible anymore. It is important that you only store pure data
in the components because otherwise you would no longer know where you
can find the logic and the approach of a clear software design would get
lost.</p><p>::: {.important}
Beginners tend to add large objects like spatials and geometries to a
component. This is a big mistake because such objects contain logic and
in our approach components are data only. Abstract it to a general level
or store it completely in the systems.
:::</p><p>::: {.important}
Never subclass Component classes.
:::</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="what-are-systems"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-are-systems" title="Direct link to heading">#</a>What are Systems?</h2><p>Simply all objects that use entities/components can be called a system.
For example <a href="/wikidemo/docs/jme3/advanced/application_states">AppStates</a>
can deal with different components and can easily be added to the
Application.</p><p>::: {.important}
Never modify the same component from different systems.
:::</p><p>If two systems are modifying the same components then there is a design
flaw. This is a sign that there is a missing component or system.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="the-back-end"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-back-end" title="Direct link to heading">#</a>The Back End</h1><p>There are two different ways of storing the information:</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="hashmaps"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#hashmaps" title="Direct link to heading">#</a>Hashmaps</h2><p>For every component class a new Hashmap is created which contains the
entityId as a key and the component as a value. Therefore if you need to
get to know all entities which owns components of a certain type the
system will search in these Hashmaps for same entityIds.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="sql"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#sql" title="Direct link to heading">#</a>SQL</h2><p>All information of the components are stored in an SQL Database, this is
done via reflection. Therefore all Components need an empty constructor
when they are stored in a database. Otherwise it is not possible to load
the Component.</p><p>Because SQL librarys can be different this Entity System only
concentrate on working with hsqldb. <a href="http://hsqldb.org/">http://hsqldb.org/</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="hybrid"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#hybrid" title="Direct link to heading">#</a>Hybrid</h2><p>Because saving/loading the component objects from a SQL Database is slow
this does not work for components who are changed recently.
(PositionComponent) On the other hand checking weather an entity owns a
special component ist faster in a SQL database. To keep both benefits
there is the Hybrid approach:</p><ul><li><p>Components are put into a Hashmap.</p></li><li><p>Persistent Components are stored in the SQL database.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="id-generation"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#id-generation" title="Direct link to heading">#</a>Id Generation</h2><p>Every entity has a unique id which is a long. Ids are not reused because
afterward they would not be unique anymore which would cause a huge
penalty.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Often people are scared that they would ran out of ids: If you create a
new entity every nano second you would need roughly 585 years before it
wraps.</p></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/8keep/wikidemo/edit/master/docs/jme3/contributions/entitysystem/advanced.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#entity-sets" class="contents__link">Entity Sets</a></li><li><a href="#components" class="contents__link">Components</a></li><li><a href="#what-are-systems" class="contents__link">What are Systems?</a></li><li><a href="#hashmaps" class="contents__link">Hashmaps</a></li><li><a href="#sql" class="contents__link">SQL</a></li><li><a href="#hybrid" class="contents__link">Hybrid</a></li><li><a href="#id-generation" class="contents__link">Id Generation</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright © 2020 jMonkeyEngine.</div></div></div></footer>
</div>

<script src="/wikidemo/styles.08ff7081.js"></script>

<script src="/wikidemo/runtime~main.0f38d2b7.js"></script>

<script src="/wikidemo/main.1b6aa70f.js"></script>

<script src="/wikidemo/1.e501629b.js"></script>

<script src="/wikidemo/2.c824d386.js"></script>

<script src="/wikidemo/302.1d1a2997.js"></script>

<script src="/wikidemo/394d525a.30c299b8.js"></script>

<script src="/wikidemo/17896441.d065d5f5.js"></script>

<script src="/wikidemo/ee7e965f.ea7050a8.js"></script>


</body>
</html>