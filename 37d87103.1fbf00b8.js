(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{209:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return i})),a.d(t,"rightToc",(function(){return l})),a.d(t,"default",(function(){return p}));var r=a(1),n=a(9),o=(a(0),a(441)),c={},i={id:"jme3/advanced/water",title:"water",description:"jMonkeyEngine offers a SimpleWaterProcessor that turns any quad (flat",source:"@site/docs/jme3/advanced/water.md",permalink:"/wikidemo/docs/jme3/advanced/water",editUrl:"https://github.com/8keep/wikidemo/edit/master/docs/jme3/advanced/water.md"},l=[],s={rightToc:l};function p(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},s,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"jMonkeyEngine offers a SimpleWaterProcessor that turns any quad (flat\nrectangle) into a reflective water surface with waves. You can use this\nquad for simple limited water surfaces such as water troughs, shallow\nfountains, puddles, shallow water in channels. The SimpleWaterProcessor\nhas less performance impact on your game than the full featured\n",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"../../jme3/advanced/post-processor_water"}),"SeaMonkey WaterFilter"),";\nthe main difference is that the SimpleWaterProcessor does not include\nunder-water effects."),Object(o.b)("p",null,"Here is some background info for JME3's basic water implementation:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(r.a)({parentName:"li"},{href:"http://www.bonzaisoftware.com/water_tut.html"}),"http://www.bonzaisoftware.com/water_tut.html"))),Object(o.b)("h1",{id:"simplewaterprocessor"},"SimpleWaterProcessor"),Object(o.b)("p",null,"A JME3 scene with water can use a ",Object(o.b)("inlineCode",{parentName:"p"},"com.jme3.water.SimpleWaterProcessor"),"\n(which implements the SceneProcessor interface)."),Object(o.b)("p",null,"To achieve a water effect, JME3 uses shaders and a special material,\n",Object(o.b)("inlineCode",{parentName:"p"},"Common/MatDefs/Water/SimpleWater.j3md"),". The water surface is a quad,\nand we use normal map and dU/dV map texturing to simulate the waves."),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Every frame, we render to three texture maps:"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},'For the water surface (reflection), we take a snapshot of the\nenvironment, flip it upside down, and clip it to the visible\nwater surface. Note that we do not actually use a "water texture\ncolor map: The "texture of the water is solely a distorted\nreflection.')),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},'For the "wavy distortion (refraction), we use the derivative of\na normal map, a dU/dV map.')),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"For the fogginess of water (depth) we use a depth map from the\nterrains z-buffer.")))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"In the shaders, we add all of the texture maps together."),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},'For the "bumpy displacement of the waves, we use a normal map\nand a du/dv map that are shifted against each other over time to\ncreate the wave effect.')),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"For the light reflection vectors on the water surface, we use\nthe Fresnel formula, together with normal vectors.")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"We add specular lighting.")))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"(For the underwater caustics effect, we use splatted textures. --\nWIP/TODO)"))),Object(o.b)("h1",{id:"usage"},"Usage"),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/images/jme3/advanced/simplewater.png",alt:"simplewater.png"}))),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Create a ",Object(o.b)("inlineCode",{parentName:"p"},"mainScene")," Node"),Object(o.b)("p",{parentName:"li"},"a.  Attach the ",Object(o.b)("inlineCode",{parentName:"p"},"mainScene")," Node to the ",Object(o.b)("inlineCode",{parentName:"p"},"rootNode"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Load your ",Object(o.b)("inlineCode",{parentName:"p"},"scene")," Spatial"),Object(o.b)("p",{parentName:"li"},"a.  Add a light source to the ",Object(o.b)("inlineCode",{parentName:"p"},"scene")," Spatial"),Object(o.b)("p",{parentName:"li"},"b.  Attach the ",Object(o.b)("inlineCode",{parentName:"p"},"scene")," Spatial to the ",Object(o.b)("inlineCode",{parentName:"p"},"mainScene")," Node")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Load your ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"../../jme3/advanced/sky"}),"sky")," Geometry"),Object(o.b)("p",{parentName:"li"},"a.  Attach the sky Geometry to the ",Object(o.b)("inlineCode",{parentName:"p"},"mainScene")," Node")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Create the SimpleWaterProcessor ",Object(o.b)("inlineCode",{parentName:"p"},"waterProcessor")),Object(o.b)("p",{parentName:"li"},"a.  Set the processor's ReflectionScene to the ",Object(o.b)("inlineCode",{parentName:"p"},"mainScene")," Spatial\n(!)"),Object(o.b)("p",{parentName:"li"},"b.  Set the processor's Plane to where you want your water surface\nto be"),Object(o.b)("p",{parentName:"li"},"c.  Set the processor's WaterDepth, DistortionScale, and WaveSpeed"),Object(o.b)("p",{parentName:"li"},"d.  Attach the processor to the ",Object(o.b)("inlineCode",{parentName:"p"},"viewPort"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Create a Quad ",Object(o.b)("inlineCode",{parentName:"p"},"quad")),Object(o.b)("p",{parentName:"li"},"a.  Set the quad's TextureCoordinates to specify the size of the\nwaves")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Create a ",Object(o.b)("inlineCode",{parentName:"p"},"water")," Geometry from the Quad"),Object(o.b)("p",{parentName:"li"},"a.  Set the water's translation and rotation (same Y value as Plane\nabove!)"),Object(o.b)("p",{parentName:"li"},"b.  Set the water's material to the processor's output material"),Object(o.b)("p",{parentName:"li"},"c.  Attach the ",Object(o.b)("inlineCode",{parentName:"p"},"water")," Geometry to the ",Object(o.b)("inlineCode",{parentName:"p"},"rootNode"),". (Not to the\nmainScene!)"))),Object(o.b)("h1",{id:"sample-code"},"Sample Code"),Object(o.b)("p",null,"The sample code can be found in ",Object(o.b)("inlineCode",{parentName:"p"},"TestSimpleWater.java")," and\n",Object(o.b)("inlineCode",{parentName:"p"},"TestSceneWater.java"),"."),Object(o.b)("p",null,"Here is the most important part of the code:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-java"}),'// we create a water processor\nSimpleWaterProcessor waterProcessor = new SimpleWaterProcessor(assetManager);\nwaterProcessor.setReflectionScene(mainScene);\n\n// we set the water plane\nVector3f waterLocation=new Vector3f(0,-6,0);\nwaterProcessor.setPlane(new Plane(Vector3f.UNIT_Y, waterLocation.dot(Vector3f.UNIT_Y)));\nviewPort.addProcessor(waterProcessor);\n\n// we set wave properties\nwaterProcessor.setWaterDepth(40);         // transparency of water\nwaterProcessor.setDistortionScale(0.05f); // strength of waves\nwaterProcessor.setWaveSpeed(0.05f);       // speed of waves\n\n// we define the wave size by setting the size of the texture coordinates\nQuad quad = new Quad(400,400);\nquad.scaleTextureCoordinates(new Vector2f(6f,6f));\n\n// we create the water geometry from the quad\nGeometry water=new Geometry("water", quad);\nwater.setLocalRotation(new Quaternion().fromAngleAxis(-FastMath.HALF_PI, Vector3f.UNIT_X));\nwater.setLocalTranslation(-200, -6, 250);\nwater.setShadowMode(ShadowMode.Receive);\nwater.setMaterial(waterProcessor.getMaterial());\nrootNode.attachChild(water);\n')),Object(o.b)("h1",{id:"settings"},"Settings"),Object(o.b)("p",null,"You can lower the render size to gain higher performance:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-java"}),"waterProcessor.setRenderSize(128,128);\n")),Object(o.b)("p",null,"The deeper the water, the more transparent. (?)"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-java"}),"waterProcessor.setWaterDepth(40);\n")),Object(o.b)("p",null,"A higher distortion scale makes bigger waves."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-java"}),"waterProcessor.setDistortionScale(0.05f);\n")),Object(o.b)("p",null,"A lower wave speed makes calmer water."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-java"}),"waterProcessor.setWaveSpeed(0.05f);\n")),Object(o.b)("p",null,"If your scene does not have a lightsource, you can set the light\ndirection for the water:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-java"}),"waterProcessor.setLightDirection( new Vector3f(0.55f, -0.82f, 0.15f));\n")),Object(o.b)("p",null,"Instead of creating a quad and specifying a plane, you can get a default\nwaterplane from the processor:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-java"}),"Geometry waterPlane = waterProcessor.createWaterGeometry(10, 10);\nwaterPlane.setLocalTranslation(-5, 0, 5);\nwaterPlane.setMaterial(waterProcessor.getMaterial());\n")),Object(o.b)("p",null,"You can offer a switch to set the water Material to a static texture --\nfor users with slow PCs."))}p.isMDXComponent=!0},441:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return d}));var r=a(0),n=a.n(r);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=n.a.createContext({}),p=function(e){var t=n.a.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i({},t,{},e)),a},b=function(e){var t=p(e.components);return n.a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},u=Object(r.forwardRef)((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),b=p(a),u=r,d=b["".concat(c,".").concat(u)]||b[u]||m[u]||o;return a?n.a.createElement(d,i({ref:t},s,{components:a})):n.a.createElement(d,i({ref:t},s))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,c=new Array(o);c[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,c[1]=i;for(var s=2;s<o;s++)c[s]=a[s];return n.a.createElement.apply(null,c)}return n.a.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);