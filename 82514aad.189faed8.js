(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{290:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return p}));var a=n(1),r=n(9),i=(n(0),n(441)),o={},s={id:"jme3/intermediate/transparency_sorting",title:"transparency_sorting",description:"There is often a lot of confusion with how pixels get processed in",source:"@site/docs/jme3/intermediate/transparency_sorting.md",permalink:"/wikidemo/docs/jme3/intermediate/transparency_sorting",editUrl:"https://github.com/8keep/wikidemo/edit/master/docs/jme3/intermediate/transparency_sorting.md",sidebar:"main",previous:{title:"how_to_use_materials",permalink:"/wikidemo/docs/jme3/intermediate/how_to_use_materials"},next:{title:"blender",permalink:"/wikidemo/docs/jme3/external/blender"}},c=[],l={rightToc:c};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"There is often a lot of confusion with how pixels get processed in\nrelation to the z-buffer and why sorting is important. Most importantly\nit can be mind-warping trying to wrap one's head around how to \\'fix\\'\nthe cases where proper sorting isn't possible."),Object(i.b)("p",null,"Hopefully these diagrams help show the futility of it all... I mean the\ntrade offs one has to make to get transparency looking its best in the\ngeneral case."),Object(i.b)("p",null,"The first image I'll show is the \\'best case\\' where all objects are\ndrawn back to front. I'll then discuss briefly the steps JME goes\nthrough to try to make that happen."),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/images/jme3/intermediate/transparency_sorting1.png",alt:"transparency_sorting1.png"}))),Object(i.b)("p",null,"In JME, the opaque layer would generally be placed in the opaque bucket.\nAll opaque layers are drawn first and within the ability to sort them,\nthey are sorted front to back to prevent overdraw."),Object(i.b)("p",null,"After the opaque bucket is drawn, the transparent bucket is drawn and it\nis sorted back to front. So in the ideal case it would appear exactly as\nin this picture."),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"Sorting is done at the object level and it can never be perfect. It is\nimpossible to properly sort objects by distance in the general case even\nif they were just triangles. Simply imagine intersecting triangles and\nit's clear there is no proper order. JME tries its best."))),Object(i.b)("p",null,"Next I'll show an image of the worst case scenario to show why sorting\nis important and how your \\'best friend\\' the z-buffer is really\ntransparency's worst enemy."),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/images/jme3/intermediate/transparency_sorting2.png",alt:"transparency_sorting2.png"}))),Object(i.b)("p",null,"This is what will happen if you put all of your objects in the opaque\nbuffer. JME will sort them front to back and you will get these strange\n\\'windows\\' into your background."),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"Because sorting is done at the object level, you may have triangle to\ntriangle overlap even within the same mesh if it is non-convex. Think of\na glass donut where the near surface triangles are drawn before the\nhole's triangles. There will be this same issue where they occlude the\nfarther triangles. A different angle on the donut might produce the\ncorrect results depending on the order of the triangles in the mesh."))),Object(i.b)("p",null,"Finally, I'll augment the worst case sorting with something like\n",Object(i.b)("inlineCode",{parentName:"p"},"alphaDiscardThreshold")," (or the old alphaTest/alphaFalloff values). In\nthis example, let's pretend we only discard pixels with alpha = 0."),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/images/jme3/intermediate/transparency_sorting3.png",alt:"transparency_sorting3.png"}))),Object(i.b)("p",null,"It's better but not perfect. Any partially transparent pixels will still\nshow the issue. Partial transparency will drive you crazy if you let it."),Object(i.b)("p",null,"Bottom line:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"back to front sorting would fix all issues")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"accurate back to front sorting in the general case is impossible")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"for purely on/off a = 1 or a = 0 transparency then a discard\nthreshold is the best bet to mitigate sorting problems.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Where 0 \\< alpha \\< 1, improper sorting of triangles/pixels will\nalways cause artifacts."))))}p.isMDXComponent=!0},441:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return u}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s({},t,{},e)),n},b=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),b=p(n),d=a,u=b["".concat(o,".").concat(d)]||b[d]||m[d]||i;return n?r.a.createElement(u,s({ref:t},l,{components:n})):r.a.createElement(u,s({ref:t},l))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);